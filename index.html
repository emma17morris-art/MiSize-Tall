<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MiSize Tall - Size Finder & Body Tracker!</title>
  <!-- Load Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --brand: #8A2BE2;
      --bg: #2b1055;
      --card: #111520;
      --border: #1b2230;
      --text: #eef1f5;
      --muted: #aab3c5;
      --blue: #1d4ed8;
      --green: #10b981;
      --orange: #f59e0b;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, sans-serif;
      background: var(--bg);
      color: var(--text);
      height: 100vh;
      overflow: hidden;
    }
    
    .topbar {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 100;
      background: rgba(15, 19, 26, .9);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--border);
      padding: 8px 16px;
    }
    
    .topbar-inner {
      display: flex;
      gap: 12px;
      align-items: center;
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .logo {
      font-size: 18px;
      font-weight: 900;
      color: #cfe0ff;
      margin-right: 8px;
    }
    
    .pill-group {
      display: flex;
      gap: 6px;
      align-items: center;
    }
    
    .pill {
      border: 1px solid rgba(255, 255, 255, .12);
      background: #151a3a;
      color: #c9d3ea;
      font-weight: 700;
      font-size: 11px;
      padding: 6px 10px;
      border-radius: 999px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .pill.active {
      background: var(--blue);
      color: #fff;
      border-color: var(--blue);
    }
    
    .spacer {
      flex: 1;
    }
    
    .main-container {
      padding-top: 80px;
      padding-bottom: 80px;
      height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
    }
    
    .header {
      margin-bottom: 40px;
    }
    
    .title {
      font-size: 48px;
      font-weight: 900;
      margin: 0 0 12px;
      color: var(--text);
    }
    
    .subtitle {
      font-size: 18px;
      color: var(--muted);
      margin: 0;
    }
    
    .region-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
      width: 100%;
      max-width: 600px;
      padding: 0 20px;
    }
    
    @media (min-width: 768px) {
      .region-grid {
        grid-template-columns: repeat(2, 1fr);
        max-width: 700px;
        gap: 24px;
      }
    }
    
    @media (min-width: 1024px) {
      .region-grid {
        grid-template-columns: repeat(4, 1fr);
        max-width: 900px;
      }
    }
    
    .region-tile {
      background: var(--blue);
      border-radius: 16px;
      padding: 32px 20px;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      border: 2px solid transparent;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 140px;
    }
    
    .region-tile:hover {
      transform: translateY(-4px);
      box-shadow: 0 20px 40px rgba(29, 78, 216, 0.3);
      border-color: rgba(255, 255, 255, 0.2);
    }
    
    .region-tile:active {
      transform: translateY(-2px);
    }
    
    .region-flag {
      font-size: 40px;
      margin-bottom: 12px;
      display: block;
    }
    
    .region-name {
      font-size: 20px;
      font-weight: 800;
      color: #fff;
      margin: 0;
    }
    
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(15, 19, 26, .9);
      backdrop-filter: blur(10px);
      border-top: 1px solid var(--border);
      display: flex;
      z-index: 100;
    }
    
    .nav-item {
      flex: 1;
      padding: 16px 12px;
      border: 0;
      background: transparent;
      color: #cfd7ea;
      font-weight: 700;
      font-size: 12px;
      cursor: pointer;
      transition: color 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .nav-item:hover {
      color: var(--brand);
    }
    
    .nav-item.active {
      color: var(--brand);
    }

    .screen {
      display: none;
      padding-top: 80px;
      padding-bottom: 80px;
      height: 100vh;
      overflow-y: auto;
    }

    .screen.active {
      display: block;
    }

    .hub-container {
      padding: 40px 20px;
      max-width: 800px;
      margin: 0 auto;
    }

    .hub-header {
      text-align: center;
      margin-bottom: 40px;
    }

    .hub-flag {
      font-size: 60px;
      margin-bottom: 16px;
    }

    .hub-title {
      font-size: 36px;
      font-weight: 900;
      margin: 0 0 8px;
    }

    .hub-subtitle {
      font-size: 16px;
      color: var(--muted);
      margin: 0;
    }

    .hub-tiles {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
    }

    .hub-tiles-4 {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
    }

    .hub-tile {
      background: var(--blue);
      border-radius: 16px;
      padding: 32px 20px;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      border: 2px solid transparent;
      text-align: center;
      color: #fff;
      font-size: 18px;
      font-weight: 800;
      min-height: 120px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .hub-tile:hover {
      transform: translateY(-4px);
      box-shadow: 0 20px 40px rgba(29, 78, 216, 0.3);
      border-color: rgba(255, 255, 255, 0.2);
    }

    .content-container {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
    }

    .form-container {
      max-width: 600px;
      margin: 0 auto;
      padding: 20px;
    }

    .form-group {
      margin-bottom: 24px;
    }

    .form-label {
      display: block;
      margin-bottom: 8px;
      font-weight: 700;
      color: var(--text);
    }

    .form-select {
      width: 100%;
      padding: 12px 16px;
      background: var(--card);
      border: 2px solid var(--border);
      border-radius: 12px;
      color: var(--text);
      font-size: 16px;
      font-weight: 600;
    }

    .form-input {
      width: 100%;
      padding: 12px 16px;
      background: var(--card);
      border: 2px solid var(--border);
      border-radius: 12px;
      color: var(--text);
      font-size: 16px;
      font-weight: 600;
    }

    .button-group {
      display: flex;
      gap: 12px;
      margin-top: 32px;
    }

    .btn {
      flex: 1;
      padding: 16px 24px;
      border: 0;
      border-radius: 12px;
      font-weight: 700;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .btn-primary {
      background: var(--brand);
      color: #fff;
    }

    .btn-secondary {
      background: var(--card);
      color: var(--text);
      border: 2px solid var(--border);
    }

    .btn:hover {
      transform: translateY(-2px);
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 16px;
      margin-bottom: 32px;
    }

    .stats-bubble {
      background: var(--card);
      border-radius: 20px;
      padding: 24px;
      text-align: center;
      border: 2px solid var(--border);
    }

    .stats-bubble.current {
      transform: scale(1.1);
      background: var(--blue);
      color: #fff;
    }

    .stats-bubble h3 {
      margin: 0 0 8px;
      font-size: 14px;
      text-transform: uppercase;
      opacity: 0.8;
    }

    .stats-bubble .value {
      font-size: 24px;
      font-weight: 900;
      margin: 0;
    }

    .progress-bar {
      width: 100%;
      height: 12px;
      background: var(--border);
      border-radius: 6px;
      overflow: hidden;
      margin: 24px 0;
    }

    .progress-fill {
      height: 100%;
      background: var(--green);
      transition: width 0.3s;
    }

    .mini-stats {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      margin-bottom: 32px;
    }

    .mini-bubble {
      background: var(--card);
      border-radius: 12px;
      padding: 16px;
      text-align: center;
      border: 2px solid var(--border);
    }

    .mini-bubble h4 {
      margin: 0 0 4px;
      font-size: 12px;
      text-transform: uppercase;
      opacity: 0.8;
    }

    .mini-bubble .value {
      font-size: 18px;
      font-weight: 700;
      margin: 0;
    }

    .bmi-indicator {
      background: var(--card);
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      border: 2px solid var(--border);
    }

    .stats-tabs {
      position: fixed;
      top: 60px;
      left: 0;
      right: 0;
      background: rgba(15, 19, 26, .9);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--border);
      display: flex;
      padding: 0 20px;
      z-index: 99;
    }

    .stats-tab {
      flex: 1;
      padding: 16px 12px;
      border: 0;
      background: transparent;
      color: #cfd7ea;
      font-weight: 700;
      font-size: 12px;
      cursor: pointer;
      transition: color 0.2s;
    }

    .stats-tab.active {
      color: var(--brand);
      border-bottom: 2px solid var(--brand);
    }

    .graph-controls {
      display: flex;
      gap: 8px;
      margin-bottom: 20px;
      justify-content: center;
    }

    .graph-btn {
      padding: 8px 16px;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text);
      font-size: 12px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .graph-btn.active {
      background: var(--brand);
      color: #fff;
      border-color: var(--brand);
    }

    .history-list {
      background: var(--card);
      border-radius: 12px;
      overflow: hidden;
      border: 2px solid var(--border);
    }

    .history-item {
      padding: 16px 20px;
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .history-item:last-child {
      border-bottom: none;
    }

    .history-date {
      font-size: 14px;
      color: var(--muted);
    }

    .help-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 16px;
      margin-bottom: 32px;
    }

    .help-card {
      background: var(--card);
      border-radius: 12px;
      padding: 20px;
      border: 2px solid var(--border);
      cursor: pointer;
      transition: all 0.3s;
    }

    .help-card:hover {
      border-color: var(--brand);
      transform: translateY(-2px);
    }

    .help-card h4 {
      margin: 0 0 8px;
      color: var(--text);
      font-weight: 800;
    }

    .help-card p {
      margin: 0;
      font-size: 14px;
      color: var(--muted);
    }

    .brand-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 16px;
      margin-top: 20px;
    }

    .brand-card {
      background: var(--card);
      border-radius: 12px;
      padding: 20px;
      border: 2px solid var(--border);
      transition: all 0.3s;
    }

    .brand-card:hover {
      border-color: var(--brand);
      transform: translateY(-2px);
    }

    .brand-name {
      font-size: 18px;
      font-weight: 800;
      margin-bottom: 8px;
      color: var(--text);
    }

    .brand-size {
      background: var(--brand);
      color: #fff;
      padding: 6px 12px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 700;
      display: inline-block;
      margin-bottom: 8px;
    }

    .confidence-indicator {
      background: var(--green);
      color: #fff;
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 600;
      margin-left: 8px;
    }

    .loading-spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255,255,255,.3);
      border-radius: 50%;
      border-top-color: var(--brand);
      animation: spin 1s ease-in-out infinite;
      margin-right: 8px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .guide-section {
      margin-bottom: 24px;
    }

    .guide-section:last-child {
      margin-bottom: 0;
    }

    .guide-section h4 {
      color: var(--brand);
      font-size: 18px;
      font-weight: 800;
      margin: 0 0 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .guide-section h5 {
      color: var(--text);
      font-size: 16px;
      font-weight: 700;
      margin: 16px 0 8px;
    }

    .guide-section p {
      margin: 0 0 8px;
      line-height: 1.6;
      color: var(--text);
    }

    .guide-section ul {
      margin: 8px 0;
      padding-left: 20px;
      color: var(--text);
    }

    .guide-section li {
      margin-bottom: 4px;
      line-height: 1.5;
    }

    .highlight-tip {
      background: rgba(138, 43, 226, 0.1);
      border-left: 4px solid var(--brand);
      padding: 12px 16px;
      margin: 16px 0;
      border-radius: 0 8px 8px 0;
    }

    .highlight-tip p {
      margin: 0;
      font-weight: 600;
    }

    .step-number {
      background: var(--brand);
      color: #fff;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: 700;
      margin-right: 8px;
    }

    .guide-tile {
      background: var(--card);
      border-radius: 12px;
      padding: 24px;
      border: 2px solid var(--border);
      margin-bottom: 24px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .guide-tile:hover {
      border-color: var(--brand);
      transform: translateY(-2px);
    }

    .guide-tile h4 {
      color: var(--brand);
      font-size: 18px;
      font-weight: 800;
      margin: 0 0 12px;
    }

    .guide-content {
      display: none;
      margin-top: 20px;
      padding-top: 20px;
      border-top: 1px solid var(--border);
    }

    .guide-content.show {
      display: block;
    }

    .settings-section {
      background: var(--card);
      border-radius: 12px;
      padding: 24px;
      border: 2px solid var(--border);
      margin-bottom: 24px;
    }

    .settings-section h3 {
      color: var(--brand);
      font-size: 20px;
      font-weight: 800;
      margin: 0 0 16px;
    }

    .pill-settings-group {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-bottom: 16px;
    }

    .settings-pill {
      border: 1px solid rgba(255, 255, 255, .12);
      background: #151a3a;
      color: #c9d3ea;
      font-weight: 700;
      font-size: 12px;
      padding: 8px 16px;
      border-radius: 999px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .settings-pill.active {
      background: var(--brand);
      color: #fff;
      border-color: var(--brand);
    }

    .profile-tile {
      background: var(--blue);
      border-radius: 12px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.3s;
      text-align: center;
      color: #fff;
      font-weight: 700;
      margin-bottom: 16px;
    }

    .profile-tile:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(29, 78, 216, 0.3);
    }

    .profile-tiles-group {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 16px;
      margin-bottom: 32px;
    }

    .profile-card {
      background: var(--card);
      border: 2px solid var(--border);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 16px;
      transition: all 0.3s;
    }

    .profile-card:hover {
      border-color: var(--brand);
    }

    .profile-name {
      font-size: 18px;
      font-weight: 800;
      margin-bottom: 8px;
    }

    .profile-details {
      font-size: 14px;
      color: var(--muted);
    }

    .measurement-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-top: 20px;
    }

    .measurement-bubble {
      background: var(--card);
      border: 2px solid var(--border);
      border-radius: 12px;
      padding: 16px;
      text-align: center;
      transition: all 0.3s;
    }

    .measurement-bubble:hover {
      border-color: var(--brand);
    }

    .measurement-bubble h4 {
      margin: 0 0 8px;
      font-size: 14px;
      font-weight: 700;
      color: var(--text);
    }

    .measurement-input {
      width: 100%;
      padding: 8px 12px;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text);
      text-align: center;
      font-weight: 600;
    }

    .system-status {
      background: var(--card);
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 24px;
      border: 2px solid var(--border);
    }

    .status-indicator {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      font-weight: 600;
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
    }

    .status-online { background: var(--green); }
    .status-loading { background: var(--orange); }
    .status-offline { background: var(--muted); }

    .source-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      border-radius: 8px;
      font-size: 12px;
      font-weight: 700;
      margin: 4px 4px 4px 0;
    }

    .source-official {
      background: var(--green);
      color: white;
    }

    .source-standard {
      background: var(--orange);
      color: white;
    }

    .source-note {
      font-size: 12px;
      color: var(--muted);
      font-style: italic;
      margin-top: 8px;
      padding-top: 8px;
      border-top: 1px solid var(--border);
    }

    .inseam-info {
      background: rgba(138, 43, 226, 0.1);
      border-radius: 8px;
      padding: 8px 12px;
      margin-top: 8px;
      font-size: 13px;
    }
  </style>
</head>
<body>
  <!-- Top Bar -->
  <div class="topbar">
    <div class="topbar-inner">
      <div class="logo">MiSize Tall</div>
      
      <div style="display: flex; align-items: center; gap: 8px;">
        <span style="font-size: 12px; color: var(--muted);">Profile:</span>
        <span id="topbar-profile-name" style="font-size: 13px; font-weight: 700; color: var(--text);">Emma Morris</span>
      </div>
      
      <div class="spacer"></div>
      
      <div class="pill-group">
        <button class="pill active" data-unit="cm">cm</button>
        <button class="pill" data-unit="inch">inch</button>
      </div>
    </div>
  </div>

  <!-- Flash Screen -->
  <div id="flash" class="screen active">
    <div class="main-container">
      <div class="header">
        <h1 class="title">Welcome to MiSize Tall</h1>
        <p class="subtitle">Your personal size finder and body tracker with AI-powered sizing!</p>
      </div>
      
      <div class="loading-spinner" style="margin: 40px auto;"></div>
      <p style="color: var(--muted); margin-top: 20px;">Loading your intelligent sizing system...</p>
    </div>
  </div>

  <!-- Home Screen -->
  <div id="home" class="screen">
    <div style="padding: 20px 20px 80px; max-width: 800px; margin: 0 auto;">
      
      <div class="system-status">
        <div class="status-indicator">
          <div class="status-dot status-online" id="system-status-dot"></div>
          <span id="system-status-text">AI sizing system ready</span>
        </div>
      </div>

      <div style="background: linear-gradient(135deg, var(--brand), var(--blue)); border-radius: 16px; padding: 24px; margin: 20px 0; border: 2px solid rgba(255,255,255,0.1);">
        <div style="display: flex; align-items: center; gap: 16px;">
          <div style="font-size: 48px;">ðŸ‘¤</div>
          <div style="text-align: left;">
            <h3 style="margin: 0 0 8px; color: white; font-size: 18px; font-weight: 800;">Get Started</h3>
            <p style="margin: 0 0 12px; color: rgba(255,255,255,0.9); font-size: 14px;">Set up your profile in Settings to unlock personalized AI sizing recommendations</p>
            <button onclick="goToScreen('uk-settings')" style="background: rgba(255,255,255,0.2); color: white; border: 2px solid rgba(255,255,255,0.3); border-radius: 8px; padding: 8px 16px; font-weight: 700; cursor: pointer; transition: all 0.2s;">
              Go to Settings â†’
            </button>
          </div>
        </div>
      </div>
      
      <div class="region-grid" style="max-width: none; padding: 0;">
        <div class="region-tile" onclick="enterHub('UK')">
          <span class="region-flag">ðŸ‡¬ðŸ‡§</span>
          <h3 class="region-name">UK</h3>
        </div>
        
        <div class="region-tile" onclick="enterHub('EU')">
          <span class="region-flag">ðŸ‡ªðŸ‡º</span>
          <h3 class="region-name">EU</h3>
        </div>
        
        <div class="region-tile" onclick="enterHub('US')">
          <span class="region-flag">ðŸ‡ºðŸ‡¸</span>
          <h3 class="region-name">US</h3>
        </div>
        
        <div class="region-tile" onclick="enterHub('CA')">
          <span class="region-flag">ðŸ‡¨ðŸ‡¦</span>
          <h3 class="region-name">CA</h3>
        </div>
      </div>
    </div>
  </div>

  <!-- MiStats Screen -->
  <div id="mistats" class="screen">
    <div class="stats-tabs">
      <button class="stats-tab active" onclick="showStatsTab('current')">Current</button>
      <button class="stats-tab" onclick="showStatsTab('graph')">Graph</button>
      <button class="stats-tab" onclick="showStatsTab('history')">History</button>
    </div>
    
    <!-- Current Progress Tab -->
    <div id="stats-current" class="stats-content active" style="padding-top: 120px;">
      <div class="content-container">
        <div class="hub-header">
          <h2 class="hub-title">Welcome back, <span id="user-name">Emma</span>!</h2>
        </div>
        
        <div class="form-group" style="max-width:320px;margin:0 auto 16px;">
          <label class="form-label" style="text-align:center;display:block;">Profile</label>
          <select class="form-select" id="mistats-profile-select"></select>
        </div>

        <div class="stats-grid">
          <div class="stats-bubble">
            <h3>Start</h3>
            <p class="value" id="start-weight">150kg</p>
            <p style="font-size: 14px; margin-top: 4px; opacity: 0.8;" id="start-bmi">BMI: 44.8</p>
          </div>
          <div class="stats-bubble current">
            <h3>Current</h3>
            <p class="value" id="current-weight">80kg</p>
            <p style="font-size: 14px; margin-top: 4px; opacity: 0.8;" id="current-bmi">BMI: 23.9</p>
          </div>
          <div class="stats-bubble">
            <h3>Target</h3>
            <p class="value" id="target-weight">80kg</p>
            <p style="font-size: 14px; margin-top: 4px; opacity: 0.8;" id="target-bmi">BMI: 23.9</p>
          </div>
        </div>
        
        <div class="progress-bar">
          <div class="progress-fill" id="progress-fill" style="width: 100%; background: var(--green);"></div>
        </div>
        <p style="text-align: center; margin-bottom: 32px;" id="progress-text">ðŸŽ‰ Goal Achieved!</p>
        
        <h3 style="text-align: center; margin-bottom: 16px;">Current Statistics</h3>
        <div class="mini-stats">
          <div class="mini-bubble">
            <h4>Body Fat %</h4>
            <p class="value" id="body-fat">22%</p>
          </div>
          <div class="mini-bubble">
            <h4>Amount Lost</h4>
            <p class="value" id="amount-lost">70kg</p>
          </div>
          <div class="mini-bubble">
            <h4>Remaining</h4>
            <p class="value" id="remaining-weight">ðŸŽ‰ Done!</p>
          </div>
        </div>
        
        <div class="bmi-indicator">
          <h4>BMI Tracker</h4>
          <p class="value" style="color: var(--green);" id="bmi-value">23.9</p>
          <p style="font-size: 14px; margin-top: 8px;" id="bmi-category">Normal Weight</p>
        </div>
      </div>
    </div>

    <!-- Graph Tab -->
    <div id="stats-graph" class="stats-content" style="display: none; padding-top: 120px;">
      <div class="content-container">
        <div class="graph-controls">
          <button class="graph-btn active" id="toggle-graph">Graph</button>
          <button class="graph-btn" id="toggle-table">Table</button>
        </div>

        <div id="graph-display">
          <canvas id="weightChartCanvas"></canvas>
        </div>

        <div id="table-display" style="display:none;">
          <table style="width:100%;border-collapse:collapse;background:var(--card);border:2px solid var(--border);border-radius:12px;overflow:hidden;">
            <thead>
              <tr style="background:var(--blue);color:#fff;">
                <th style="padding:12px;">Date</th>
                <th style="padding:12px;">Weight</th>
                <th style="padding:12px;">BMI</th>
              </tr>
            </thead>
            <tbody id="stats-table-body">
              <!-- Populated by JS -->
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- History Tab -->
    <div id="stats-history" class="stats-content" style="display: none; padding-top: 120px;">
      <div class="content-container">
        <h3>Measurement History</h3>
        <div class="history-list" id="measurement-history">
          <!-- History will be populated here -->
        </div>
      </div>
    </div>
  </div>

  <!-- Bottom Navigation -->
  <div class="bottom-nav">
    <button class="nav-item active" onclick="goHome()">Home</button>
    <button class="nav-item" onclick="goToMiStats()">MiStats</button>
    <button class="nav-item" onclick="goToSettings()">Settings</button>
    <button class="nav-item" onclick="goToHelp()">Help</button>
    <button class="nav-item" onclick="goBack()">Back</button>
  </div>
  
  <script>
    // Global variables
    let currentScreen = 'home';
    let navigationHistory = [];
    let currentProfile = 'Emma Morris';

    // Profile Data
    let profileData = {
      'Emma Morris': {
        name: 'Emma Morris',
        dateOfBirth: '1983-10-12',
        gender: 'female',
        bodyFrame: 'medium',
        startingDate: '2022-03-19',
        startingWeight: { value: 150, unit: 'kg' },
        startingHeight: { value: 183, unit: 'cm' },
        targetWeight: { value: 80, unit: 'kg' },
        targetDate: '2023-06-30',
        measurements: { weight: 80, chest: 36, waist: 32, hips: 38, inseam: 35, shoulders: 38, arms: 28 },
        history: [
          { date: '2022-03-19', type: 'weight', value: 150, unit: 'kg' },
          { date: '2022-04-19', type: 'weight', value: 147, unit: 'kg' },
          { date: '2022-05-19', type: 'weight', value: 143, unit: 'kg' },
          { date: '2022-06-19', type: 'weight', value: 138, unit: 'kg' },
          { date: '2022-07-19', type: 'weight', value: 133, unit: 'kg' },
          { date: '2022-08-19', type: 'weight', value: 128, unit: 'kg' },
          { date: '2022-09-19', type: 'weight', value: 123, unit: 'kg' },
          { date: '2022-10-19', type: 'weight', value: 118, unit: 'kg' },
          { date: '2022-11-19', type: 'weight', value: 113, unit: 'kg' },
          { date: '2022-12-19', type: 'weight', value: 108, unit: 'kg' },
          { date: '2023-01-19', type: 'weight', value: 103, unit: 'kg' },
          { date: '2023-02-19', type: 'weight', value: 98, unit: 'kg' },
          { date: '2023-03-19', type: 'weight', value: 93, unit: 'kg' },
          { date: '2023-04-19', type: 'weight', value: 90, unit: 'kg' },
          { date: '2023-05-19', type: 'weight', value: 87, unit: 'kg' },
          { date: '2023-06-19', type: 'weight', value: 84, unit: 'kg' },
          { date: '2023-07-19', type: 'weight', value: 82, unit: 'kg' },
          { date: '2023-08-19', type: 'weight', value: 80, unit: 'kg' },
          { date: '2024-01-15', type: 'weight', value: 80, unit: 'kg' },
          { date: '2024-03-15', type: 'weight', value: 80, unit: 'kg' }
        ]
      }
    };

    // Navigation functions
    function enterHub(region) {
      alert(`${region} hub coming soon!`);
    }

    function goToScreen(screenId) {
      if (currentScreen !== screenId) {
        navigationHistory.push(currentScreen);
      }

      document.querySelectorAll('.screen').forEach(screen => {
        screen.classList.remove('active');
      });

      const targetScreen = document.getElementById(screenId);
      if (targetScreen) {
        targetScreen.classList.add('active');
        currentScreen = screenId;
        updateScreenData(screenId);
        updateNavigation();
      }
    }

    function updateScreenData(screenId) {
      if (screenId === 'mistats') {
        populateMiStatsProfileSelect();
        renderMiStats();
        renderWeightChart();
      }
    }

    function goHome() {
      navigationHistory = [];
      goToScreen('home');
    }

    function goToMiStats() {
      goToScreen('mistats');
    }

    function goToSettings() {
      alert('Settings coming soon!');
    }

    function goToHelp() {
      alert('Help coming soon!');
    }

    function goBack() {
      if (navigationHistory.length > 0) {
        const previousScreen = navigationHistory.pop();
        document.querySelectorAll('.screen').forEach(screen => {
          screen.classList.remove('active');
        });

        const targetScreen = document.getElementById(previousScreen);
        if (targetScreen) {
          targetScreen.classList.add('active');
          currentScreen = previousScreen;
          updateScreenData(previousScreen);
          updateNavigation();
        }
      }
    }

    function updateNavigation() {
      document.querySelectorAll('.nav-item').forEach(item => {
        item.classList.remove('active');
      });

      if (currentScreen === 'home') {
        document.querySelector('.nav-item[onclick="goHome()"]')?.classList.add('active');
      } else if (currentScreen === 'mistats') {
        document.querySelector('.nav-item[onclick="goToMiStats()"]')?.classList.add('active');
      }
    }

    // Utility functions
    function kgFrom(value, unit) {
      if (unit === 'kg') return value;
      if (unit === 'lbs') return value * 0.45359237;
      if (unit === 'stone') return value * 6.35029318;
      return value;
    }

    function cmFrom(value, unit) {
      if (unit === 'cm') return value;
      if (unit === 'inch') return value * 2.54;
      return value;
    }

    function computeBMIKgCm(weightKg, heightCm) {
      const h = heightCm / 100;
      if (!h) return null;
      return weightKg / (h * h);
    }

    function bmiCategory(bmi) {
      if (bmi == null) return '';
      if (bmi < 18.5) return 'Underweight';
      if (bmi < 25) return 'Normal Weight';
      if (bmi < 30) return 'Overweight';
      return 'Obese';
    }

    // MiStats functions
    function showStatsTab(tabName) {
      document.querySelectorAll('.stats-tab').forEach(tab => {
        tab.classList.remove('active');
      });

      document.querySelectorAll('.stats-content').forEach(content => {
        content.style.display = 'none';
      });

      const activeTab = document.querySelector(`[onclick="showStatsTab('${tabName}')"]`);
      const activeContent = document.getElementById(`stats-${tabName}`);

      if (activeTab) activeTab.classList.add('active');
      if (activeContent) activeContent.style.display = 'block';
    }

    function setCurrentProfile(name) {
      if (!profileData[name]) return;
      currentProfile = name;

      const sel = document.getElementById('mistats-profile-select');
      if (sel) sel.value = name;

      const topbarName = document.getElementById('topbar-profile-name');
      if (topbarName) topbarName.textContent = name;

      renderMiStats();
      renderWeightChart();
    }

    function populateMiStatsProfileSelect() {
      const sel = document.getElementById('mistats-profile-select');
      if (!sel) return;
      sel.innerHTML = Object.keys(profileData).map(n => `<option value="${n}">${n}</option>`).join('');
      if (currentProfile && profileData[currentProfile]) {
        sel.value = currentProfile;
      }
      sel.onchange = () => setCurrentProfile(sel.value);
    }

    function renderMiStats() {
      const p = profileData[currentProfile];
      if (!p) return;

      const startKg = kgFrom(p.startingWeight.value, p.startingWeight.unit);
      const heightCm = cmFrom(p.startingHeight.value, p.startingHeight.unit);

      const allWeightEntries = [
        { date: p.startingDate, value: p.startingWeight.value, unit: p.startingWeight.unit },
        ...(p.history || []).filter(e => e.type === 'weight')
      ].sort((a, b) => new Date(a.date) - new Date(b.date));

      const latestWeightEntry = allWeightEntries[allWeightEntries.length - 1];
      const currentWeightVal = latestWeightEntry?.value ?? p.startingWeight.value;
      const currentWeightUnit = latestWeightEntry?.unit ?? p.startingWeight.unit;
      const currentKg = kgFrom(currentWeightVal, currentWeightUnit);

      const targetKg = p.targetWeight ? kgFrom(p.targetWeight.value, p.targetWeight.unit) : null;

      const startBMI = computeBMIKgCm(startKg, heightCm);
      const currentBMI = computeBMIKgCm(currentKg, heightCm);
      const targetBMI = targetKg ? computeBMIKgCm(targetKg, heightCm) : null;

      document.getElementById('user-name').textContent = p.name.split(' ')[0];
      document.getElementById('start-weight').textContent = `${p.startingWeight.value}${p.startingWeight.unit}`;
      document.getElementById('current-weight').textContent = `${currentWeightVal}${currentWeightUnit}`;
      document.getElementById('target-weight').textContent = p.targetWeight ? `${p.targetWeight.value}${p.targetWeight.unit}` : 'â€”';

      document.getElementById('start-bmi').textContent = startBMI ? `BMI: ${(Math.round(startBMI * 10) / 10)}` : 'BMI: â€”';
      document.getElementById('current-bmi').textContent = currentBMI ? `BMI: ${(Math.round(currentBMI * 10) / 10)}` : 'BMI: â€”';
      document.getElementById('target-bmi').textContent = targetBMI ? `BMI: ${(Math.round(targetBMI * 10) / 10)}` : 'BMI: â€”';

      const lostKg = startKg - currentKg;
      const remainingKg = (targetKg != null) ? Math.max(0, currentKg - targetKg) : null;
      const progressPct = (targetKg != null && startKg !== targetKg)
        ? Math.max(0, Math.min(100, ((startKg - currentKg) / (startKg - targetKg)) * 100))
        : 0;

      document.getElementById('amount-lost').textContent = `${Math.round(lostKg * 10) / 10}kg`;
      document.getElementById('remaining-weight').textContent = (remainingKg != null)
        ? `${Math.round(remainingKg * 10) / 10}kg` : 'ðŸŽ‰ Goal Reached!';
      document.getElementById('progress-fill').style.width = `${Math.round(progressPct)}%`;
      document.getElementById('progress-text').textContent = `${Math.round(progressPct)}% to goal`;

      if (remainingKg !== null && remainingKg <= 0) {
        document.getElementById('progress-text').textContent = 'ðŸŽ‰ Congratulations! Goal achieved!';
        document.getElementById('progress-fill').style.background = 'var(--green)';
      }

      const bmi = computeBMIKgCm(currentKg, heightCm);
      if (bmi) {
        document.getElementById('bmi-value').textContent = (Math.round(bmi * 10) / 10).toString();
        document.getElementById('bmi-category').textContent = bmiCategory(bmi);
      }

      renderMeasurementHistory();
    }

    function renderMeasurementHistory() {
      const container = document.getElementById('measurement-history');
      if (!container) return;

      const p = profileData[currentProfile];
      if (!p || !p.history) {
        container.innerHTML = '<div class="history-item">No measurement history available</div>';
        return;
      }

      const history = [...p.history].sort((a, b) => new Date(b.date) - new Date(a.date));
      
      container.innerHTML = history.map(entry => `
        <div class="history-item">
          <div>
            <strong>${entry.type.charAt(0).toUpperCase() + entry.type.slice(1)}: ${entry.value}${entry.unit}</strong><br>
            <span class="history-date">${new Date(entry.date).toLocaleDateString()}</span>
          </div>
        </div>
      `).join('');
    }

    // Chart.js functions
    let weightChart = null;

    function renderWeightChart() {
      const p = profileData[currentProfile];
      if (!p) return;

      const history = p.history.filter(h => h.type === "weight");
      const labels = history.map(h => h.date);
      const data = history.map(h => h.value);

      const ctx = document.getElementById("weightChartCanvas");
      if (!ctx) return;

      if (weightChart) {
        weightChart.destroy();
      }

      weightChart = new Chart(ctx, {
        type: "line",
        data: {
          labels,
          datasets: [{
            label: "Weight (kg)",
            data,
            borderColor: "#8A2BE2",
            backgroundColor: "rgba(138,43,226,0.3)",
            borderWidth: 2,
            pointRadius: 4,
            tension: 0.3
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          plugins: { 
            legend: { 
              labels: { 
                color: "#fff" 
              } 
            } 
          },
          scales: {
            x: { 
              ticks: { color: "#fff" }, 
              grid: { color: "#444" } 
            },
            y: { 
              ticks: { color: "#fff" }, 
              grid: { color: "#444" } 
            }
          }
        }
      });
    }

    function renderHistoryTable() {
      const p = profileData[currentProfile];
      if (!p) return;

      const history = p.history.filter(h => h.type === "weight");
      const tbody = document.getElementById("stats-table-body");
      if (!tbody) return;

      tbody.innerHTML = "";

      history.forEach(entry => {
        const heightCm = cmFrom(p.startingHeight.value, p.startingHeight.unit);
        const weightKg = kgFrom(entry.value, entry.unit);
        const bmi = computeBMIKgCm(weightKg, heightCm);
        const bmiStr = bmi ? bmi.toFixed(1) : 'â€”';

        tbody.innerHTML += `
          <tr style="border-bottom: 1px solid var(--border);">
            <td style="padding:10px;">${entry.date}</td>
            <td style="padding:10px;">${entry.value} ${entry.unit}</td>
            <td style="padding:10px;">${bmiStr}</td>
          </tr>`;
      });
    }

    // Toggle Graph/Table
    document.addEventListener('DOMContentLoaded', () => {
      const toggleGraph = document.getElementById("toggle-graph");
      const toggleTable = document.getElementById("toggle-table");

      if (toggleGraph) {
        toggleGraph.addEventListener("click", () => {
          document.getElementById("graph-display").style.display = "block";
          document.getElementById("table-display").style.display = "none";
          toggleGraph.classList.add("active");
          toggleTable.classList.remove("active");
          renderWeightChart();
        });
      }

      if (toggleTable) {
        toggleTable.addEventListener("click", () => {
          document.getElementById("graph-display").style.display = "none";
          document.getElementById("table-display").style.display = "block";
          toggleTable.classList.add("active");
          toggleGraph.classList.remove("active");
          renderHistoryTable();
        });
      }
    });

    // Initialize App
    function initializeApp() {
      console.log('Initializing MiSize Tall App...');
      
      setTimeout(() => {
        document.getElementById("flash").classList.remove("active");
        
        const home = document.getElementById("home");
        if (home) {
          home.classList.add("active");
        }

        console.log("âœ… App Initialized");
      }, 1500);
    }

    // Run when page loads
    window.addEventListener("DOMContentLoaded", () => {
      initializeApp();
    });
  </script>
</body>
</html>
