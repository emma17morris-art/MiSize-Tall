<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MiSize - Size Finder & Body Tracker</title>
  <style>
    :root {
      --brand: #8A2BE2;
      --bg: #2b1055;
      --card: #111520;
      --border: #1b2230;
      --text: #eef1f5;
      --muted: #aab3c5;
      --blue: #1d4ed8;
      --green: #10b981;
      --orange: #f59e0b;
      --red: #ef4444;
    }
    
    * { box-sizing: border-box; }
    
    body {
      margin: 0;
      font-family: system-ui, -apple-system, sans-serif;
      background: var(--bg);
      color: var(--text);
      height: 100vh;
      overflow: hidden;
    }
    
    .topbar {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 100;
      background: rgba(15, 19, 26, .9);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--border);
      padding: 8px 16px;
    }
    
    .topbar-inner {
      display: flex;
      gap: 12px;
      align-items: center;
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .logo {
      font-size: 18px;
      font-weight: 900;
      color: #cfe0ff;
      margin-right: 8px;
    }
    
    .pill-group {
      display: flex;
      gap: 6px;
      align-items: center;
    }
    
    .pill {
      border: 1px solid rgba(255, 255, 255, .12);
      background: #151a3a;
      color: #c9d3ea;
      font-weight: 700;
      font-size: 11px;
      padding: 6px 10px;
      border-radius: 999px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .pill.active {
      background: var(--blue);
      color: #fff;
      border-color: var(--blue);
    }
    
    .spacer { flex: 1; }
    
    .screen {
      display: none;
      padding-top: 80px;
      padding-bottom: 80px;
      height: 100vh;
      overflow-y: auto;
    }
    
    .screen.active { display: block; }
    
    /* All your existing styles preserved */
    .main-container {
      padding-top: 80px;
      padding-bottom: 80px;
      height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
    }
    
    .header { margin-bottom: 40px; }
    
    .title {
      font-size: 48px;
      font-weight: 900;
      margin: 0 0 12px;
      color: var(--text);
    }
    
    .subtitle {
      font-size: 18px;
      color: var(--muted);
      margin: 0;
    }
    
    .region-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
      width: 100%;
      max-width: 600px;
      padding: 0 20px;
    }
    
    @media (min-width: 768px) {
      .region-grid {
        grid-template-columns: repeat(2, 1fr);
        max-width: 700px;
        gap: 24px;
      }
    }
    
    @media (min-width: 1024px) {
      .region-grid {
        grid-template-columns: repeat(4, 1fr);
        max-width: 900px;
      }
    }
    
    .region-tile {
      background: var(--blue);
      border-radius: 16px;
      padding: 32px 20px;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      border: 2px solid transparent;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 140px;
    }
    
    .region-tile:hover {
      transform: translateY(-4px);
      box-shadow: 0 20px 40px rgba(29, 78, 216, 0.3);
      border-color: rgba(255, 255, 255, 0.2);
    }
    
    .region-flag {
      font-size: 40px;
      margin-bottom: 12px;
    }
    
    .region-name {
      font-size: 20px;
      font-weight: 800;
      color: #fff;
      margin: 0;
    }
    
    .hub-container {
      padding: 40px 20px;
      max-width: 800px;
      margin: 0 auto;
    }
    
    .hub-header {
      text-align: center;
      margin-bottom: 40px;
    }
    
    .hub-flag { font-size: 60px; margin-bottom: 16px; }
    
    .hub-title {
      font-size: 36px;
      font-weight: 900;
      margin: 0 0 8px;
    }
    
    .hub-subtitle {
      font-size: 16px;
      color: var(--muted);
      margin: 0;
    }
    
    .hub-tiles {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
    }
    
    .hub-tile {
      background: var(--blue);
      border-radius: 16px;
      padding: 32px 20px;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      border: 2px solid transparent;
      text-align: center;
      color: #fff;
      font-size: 18px;
      font-weight: 800;
      min-height: 120px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .hub-tile:hover {
      transform: translateY(-4px);
      box-shadow: 0 20px 40px rgba(29, 78, 216, 0.3);
      border-color: rgba(255, 255, 255, 0.2);
    }
    
    .form-container {
      max-width: 600px;
      margin: 0 auto;
      padding: 20px;
    }
    
    .form-group { margin-bottom: 24px; }
    
    .form-label {
      display: block;
      margin-bottom: 8px;
      font-weight: 700;
      color: var(--text);
    }
    
    .form-input, .form-select {
      width: 100%;
      padding: 12px 16px;
      background: var(--card);
      border: 2px solid var(--border);
      border-radius: 12px;
      color: var(--text);
      font-size: 16px;
      font-weight: 600;
    }
    
    .button-group {
      display: flex;
      gap: 12px;
      margin-top: 32px;
    }
    
    .btn {
      flex: 1;
      padding: 16px 24px;
      border: 0;
      border-radius: 12px;
      font-weight: 700;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .btn-primary {
      background: var(--brand);
      color: #fff;
    }
    
    .btn-secondary {
      background: var(--card);
      color: var(--text);
      border: 2px solid var(--border);
    }
    
    .btn-danger {
      background: var(--red);
      color: #fff;
    }
    
    .btn:hover { transform: translateY(-2px); }
    
    .content-container {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
    }
    
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(15, 19, 26, .9);
      backdrop-filter: blur(10px);
      border-top: 1px solid var(--border);
      display: flex;
      z-index: 100;
    }
    
    .nav-item {
      flex: 1;
      padding: 16px 12px;
      border: 0;
      background: transparent;
      color: #cfd7ea;
      font-weight: 700;
      font-size: 12px;
      cursor: pointer;
      transition: color 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .nav-item:hover { color: var(--brand); }
    .nav-item.active { color: var(--brand); }
    
    /* Advanced Features Styles */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 16px;
      margin-bottom: 32px;
    }
    
    .stats-bubble {
      background: var(--card);
      border-radius: 20px;
      padding: 24px;
      text-align: center;
      border: 2px solid var(--border);
      transition: all 0.3s;
    }
    
    .stats-bubble.current {
      transform: scale(1.05);
      background: var(--blue);
      color: #fff;
    }
    
    .stats-bubble h3 {
      margin: 0 0 8px;
      font-size: 14px;
      text-transform: uppercase;
      opacity: 0.8;
    }
    
    .stats-bubble .value {
      font-size: 24px;
      font-weight: 900;
      margin: 0;
    }
    
    .progress-bar {
      width: 100%;
      height: 12px;
      background: var(--border);
      border-radius: 6px;
      overflow: hidden;
      margin: 24px 0;
    }
    
    .progress-fill {
      height: 100%;
      background: var(--green);
      transition: width 0.3s;
    }
    
    .settings-section {
      background: var(--card);
      border-radius: 12px;
      padding: 24px;
      border: 2px solid var(--border);
      margin-bottom: 24px;
    }
    
    .settings-section h3 {
      color: var(--brand);
      font-size: 20px;
      font-weight: 800;
      margin: 0 0 16px;
    }
    
    .profile-management-pills {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 16px;
      margin-bottom: 32px;
    }
    
    .profile-pill {
      background: var(--blue);
      border-radius: 16px;
      padding: 24px 20px;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      border: 2px solid transparent;
      text-align: center;
      color: #fff;
      font-size: 16px;
      font-weight: 800;
      min-height: 100px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
    }
    
    .profile-pill:hover {
      transform: translateY(-4px);
      box-shadow: 0 20px 40px rgba(29, 78, 216, 0.3);
    }
    
    .profile-pill .emoji {
      font-size: 24px;
      margin-bottom: 8px;
    }
    
    .brand-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 16px;
      margin-top: 20px;
    }
    
    .brand-card {
      background: var(--card);
      border-radius: 12px;
      padding: 20px;
      border: 2px solid var(--border);
      transition: all 0.3s;
    }
    
    .brand-card:hover {
      border-color: var(--brand);
      transform: translateY(-2px);
    }
    
    .brand-name {
      font-size: 18px;
      font-weight: 800;
      margin-bottom: 8px;
      color: var(--text);
    }
    
    .brand-size {
      background: var(--brand);
      color: #fff;
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 700;
      display: inline-block;
      margin: 2px;
    }
    
    .measurement-history {
      background: var(--card);
      border-radius: 12px;
      padding: 20px;
      border: 2px solid var(--border);
      margin-top: 20px;
    }
    
    .history-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 0;
      border-bottom: 1px solid var(--border);
    }
    
    .history-item:last-child {
      border-bottom: none;
    }
    
    .size-result-display {
      background: var(--green);
      color: #fff;
      padding: 20px;
      border-radius: 12px;
      text-align: center;
      margin-top: 20px;
      font-weight: 800;
      font-size: 18px;
      display: none;
    }
    
    .size-result-display.show {
      display: block;
      animation: slideInUp 0.3s ease;
    }
    
    @keyframes slideInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .chart-container {
      background: var(--card);
      border-radius: 12px;
      padding: 20px;
      border: 2px solid var(--border);
      margin: 20px 0;
    }
    
    .tabs {
      display: flex;
      margin-bottom: 20px;
      background: var(--bg);
      border-radius: 8px;
      padding: 4px;
    }
    
    .tab {
      flex: 1;
      padding: 12px;
      text-align: center;
      cursor: pointer;
      border-radius: 6px;
      transition: all 0.2s;
      font-weight: 700;
      font-size: 14px;
    }
    
    .tab.active {
      background: var(--brand);
      color: #fff;
    }
    
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.8);
      z-index: 200;
      padding: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .modal-content {
      background: var(--card);
      border-radius: 12px;
      padding: 24px;
      max-width: 600px;
      width: 100%;
      max-height: 80vh;
      overflow-y: auto;
    }
    
    .help-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 16px;
      margin: 20px 0;
    }
    
    .help-card {
      background: var(--card);
      border-radius: 12px;
      padding: 20px;
      border: 2px solid var(--border);
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .help-card:hover {
      border-color: var(--brand);
      transform: translateY(-2px);
    }
    
    .help-card h4 {
      color: var(--brand);
      margin: 0 0 8px;
      font-weight: 800;
    }
    
    .help-card p {
      margin: 0;
      color: var(--muted);
      font-size: 14px;
    }
    
    .notification {
      position: fixed;
      top: 80px;
      right: 20px;
      background: var(--green);
      color: #fff;
      padding: 12px 20px;
      border-radius: 8px;
      font-weight: 700;
      z-index: 150;
      transform: translateX(100%);
      transition: transform 0.3s;
    }
    
    .notification.show {
      transform: translateX(0);
    }
    
    .notification.error {
      background: var(--red);
    }
    
    .notification.warning {
      background: var(--orange);
    }
  </style>
</head>
<body>
  <!-- Top Bar -->
  <div class="topbar">
    <div class="topbar-inner">
      <div class="logo">MiSize</div>
      
      <div class="pill-group">
        <button class="pill active" data-type="standard">Std</button>
        <button class="pill" data-type="petite">Petite</button>
        <button class="pill" data-type="tall">Tall</button>
        <button class="pill" data-type="plus">Plus</button>
      </div>
      
      <div class="spacer"></div>
      
      <div class="pill-group">
        <button class="pill active" data-unit="cm">cm</button>
        <button class="pill" data-unit="inch">inch</button>
      </div>
    </div>
  </div>

  <!-- Home Screen -->
  <div id="home" class="screen active">
    <div class="main-container">
      <div class="header">
        <h1 class="title">Welcome to MiSize</h1>
        <p class="subtitle">Your personal size finder and body tracker</p>
      </div>
      
      <div class="region-grid">
        <div class="region-tile" onclick="enterHub('US')">
          <span class="region-flag">üá∫üá∏</span>
          <h3 class="region-name">US</h3>
        </div>
        <div class="region-tile" onclick="enterHub('UK')">
          <span class="region-flag">üá¨üáß</span>
          <h3 class="region-name">UK</h3>
        </div>
        <div class="region-tile" onclick="enterHub('EU')">
          <span class="region-flag">üá™üá∫</span>
          <h3 class="region-name">EU</h3>
        </div>
        <div class="region-tile" onclick="enterHub('AU')">
          <span class="region-flag">üá¶üá∫</span>
          <h3 class="region-name">AU</h3>
        </div>
      </div>
    </div>
  </div>

  <!-- Hub Screen -->
  <div id="hub" class="screen">
    <div class="hub-container">
      <div class="hub-header">
        <div class="hub-flag">üá∫üá∏</div>
        <h1 class="hub-title">US Sizing</h1>
        <p class="hub-subtitle">Select a category to find your perfect size</p>
      </div>
      
      <div class="hub-tiles">
        <div class="hub-tile" onclick="showSizeFinder('tops')">Tops</div>
        <div class="hub-tile" onclick="showSizeFinder('dresses')">Dresses</div>
        <div class="hub-tile" onclick="showSizeFinder('bottoms')">Bottoms</div>
        <div class="hub-tile" onclick="showSizeFinder('activewear')">Activewear</div>
      </div>
    </div>
  </div>

  <!-- Size Finder Screen -->
  <div id="sizeFinder" class="screen">
    <div class="form-container">
      <h2 style="text-align: center; margin-bottom: 30px;">Find Your Size</h2>
      
      <div id="measurementForm">
        <div class="form-group">
          <label class="form-label">Bust (cm)</label>
          <input type="number" class="form-input" id="bust" placeholder="Enter bust measurement">
        </div>
        
        <div class="form-group">
          <label class="form-label">Waist (cm)</label>
          <input type="number" class="form-input" id="waist" placeholder="Enter waist measurement">
        </div>
        
        <div class="form-group">
          <label class="form-label">Hips (cm)</label>
          <input type="number" class="form-input" id="hips" placeholder="Enter hip measurement">
        </div>
        
        <div class="button-group">
          <button class="btn btn-secondary" onclick="goBack()">Back</button>
          <button class="btn btn-primary" onclick="calculateSize()">Find My Size</button>
        </div>
      </div>

      <div id="sizeResult" class="size-result-display">
        <div style="margin-bottom: 16px;">Your recommended size is:</div>
        <div style="font-size: 28px; font-weight: 900;" id="resultSize"></div>
      </div>

      <div id="brandRecommendations" style="display: none;">
        <h3 style="text-align: center; margin: 30px 0 20px; color: var(--brand);">Brand Recommendations</h3>
        <div class="brand-grid" id="brandGrid"></div>
      </div>
    </div>
  </div>

  <!-- Stats Screen -->
  <div id="stats" class="screen">
    <div class="content-container">
      <h2 style="text-align: center; margin-bottom: 30px;">Body Stats & Tracking</h2>
      
      <div class="tabs">
        <div class="tab active" onclick="showStatsTab('overview')">Overview</div>
        <div class="tab" onclick="showStatsTab('measurements')">Measurements</div>
        <div class="tab" onclick="showStatsTab('history')">History</div>
      </div>

      <div id="statsOverview" class="tab-content">
        <div class="stats-grid">
          <div class="stats-bubble current">
            <h3>Current BMI</h3>
            <div class="value" id="currentBMI">--</div>
          </div>
          <div class="stats-bubble">
            <h3>Measurements</h3>
            <div class="value" id="totalMeasurements">0</div>
          </div>
          <div class="stats-bubble">
            <h3>Active Days</h3>
            <div class="value" id="activeDays">0</div>
          </div>
        </div>

        <div class="chart-container">
          <h4 style="margin: 0 0 16px; color: var(--brand);">Progress Overview</h4>
          <div class="progress-bar">
            <div class="progress-fill" style="width: 65%;"></div>
          </div>
          <p style="text-align: center; color: var(--muted); margin: 0;">Track more measurements to see detailed progress</p>
        </div>
      </div>

      <div id="statsMeasurements" class="tab-content" style="display: none;">
        <div style="text-align: center; padding: 40px; background: var(--card); border-radius: 12px; border: 2px solid var(--border);">
          <h3 style="color: var(--brand); margin-bottom: 16px;">Quick Measurements</h3>
          <p style="color: var(--muted); margin-bottom: 20px;">Add measurements to track your progress</p>
          <button class="btn btn-primary" onclick="showQuickMeasurement()" style="max-width: 200px;">Add Measurement</button>
        </div>
      </div>

      <div id="statsHistory" class="tab-content" style="display: none;">
        <div class="measurement-history">
          <h4 style="margin: 0 0 16px; color: var(--brand);">Recent Measurements</h4>
          <div id="historyList">
            <p style="text-align: center; color: var(--muted); margin: 20px 0;">No measurements recorded yet</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Help Screen -->
  <div id="help" class="screen">
    <div class="content-container">
      <h2 style="text-align: center; margin-bottom: 30px;">Help & Guides</h2>
      
      <div class="help-grid">
        <div class="help-card" onclick="showHelpModal('measuring')">
          <h4>üìè How to Measure</h4>
          <p>Learn the proper techniques for taking accurate body measurements</p>
        </div>
        
        <div class="help-card" onclick="showHelpModal('sizes')">
          <h4>üìä Understanding Sizes</h4>
          <p>Learn how different regions and brands approach sizing</p>
        </div>
        
        <div class="help-card" onclick="showHelpModal('profiles')">
          <h4>üë§ Managing Profiles</h4>
          <p>Create and manage multiple measurement profiles</p>
        </div>
        
        <div class="help-card" onclick="showHelpModal('tips')">
          <h4>üí° Size Tips</h4>
          <p>Pro tips for finding the perfect fit every time</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Settings Screen -->
  <div id="settings" class="screen">
    <div class="content-container">
      <h2 style="text-align: center; margin-bottom: 30px;">Settings & Profiles</h2>
      
      <div class="settings-section">
        <h3>Profile Management</h3>
        <div class="profile-management-pills">
          <div class="profile-pill" onclick="showCreateProfile()">
            <div class="emoji">üë§</div>
            <div>Create Profile</div>
          </div>
          <div class="profile-pill" onclick="showViewProfiles()">
            <div class="emoji">üìã</div>
            <div>View Profiles</div>
          </div>
          <div class="profile-pill" onclick="showImportExport()">
            <div class="emoji">üíæ</div>
            <div>Import/Export</div>
          </div>
        </div>
      </div>

      <div class="settings-section">
        <h3>App Preferences</h3>
        <p style="color: var(--muted); margin: 0;">Use the controls at the top to change measurement units and size types.</p>
      </div>

      <div class="settings-section">
        <h3>Data Management</h3>
        <div style="display: flex; gap: 12px; margin-top: 16px;">
          <button class="btn btn-secondary" onclick="clearAllData()" style="flex: none; padding: 12px 24px;">Clear All Data</button>
          <button class="btn btn-primary" onclick="exportAllData()" style="flex: none; padding: 12px 24px;">Export Data</button>
        </div>
      </div>

      <div class="settings-section">
        <h3>About MiSize</h3>
        <p style="color: var(--muted); margin: 0 0 8px;">Version 2.0.0</p>
        <p style="color: var(--muted); margin: 0;">Your comprehensive size finder and body tracking companion.</p>
      </div>
    </div>
  </div>

  <!-- Bottom Navigation -->
  <div class="bottom-nav">
    <button class="nav-item active" onclick="showScreen('home')">Home</button>
    <button class="nav-item" onclick="showScreen('stats')">Stats</button>
    <button class="nav-item" onclick="showScreen('help')">Help</button>
    <button class="nav-item" onclick="showScreen('settings')">Settings</button>
  </div>

  <script>
    // Core Application State
    let appState = {
      currentRegion: 'US',
      currentCategory: '',
      currentUnit: 'cm',
      currentType: 'standard',
      profiles: JSON.parse(localStorage.getItem('misize_profiles') || '[]'),
      currentProfile: localStorage.getItem('misize_current_profile') || null,
      measurements: JSON.parse(localStorage.getItem('misize_measurements') || '[]'),
      settings: JSON.parse(localStorage.getItem('misize_settings') || '{}'),
      brands: JSON.parse(localStorage.getItem('misize_brands') || '{}')
    };

    // Size Charts Database
    const sizeCharts = {
      US: {
        standard: {
          tops: [
            { size: 'XS', bust: [81, 84], waist: [61, 64], hips: [86, 89] },
            { size: 'S', bust: [84, 89], waist: [64, 69], hips: [89, 94] },
            { size: 'M', bust: [89, 94], waist: [69, 74], hips: [94, 99] },
            { size: 'L', bust: [94, 99], waist: [74, 79], hips: [99, 104] },
            { size: 'XL', bust: [99, 104], waist: [79, 84], hips: [104, 109] },
            { size: 'XXL', bust: [104, 109], waist: [84, 89], hips: [109, 114] }
          ],
          dresses: [
            { size: 'XS', bust: [81, 84], waist: [61, 64], hips: [86, 89] },
            { size: 'S', bust: [84, 89], waist: [64, 69], hips: [89, 94] },
            { size: 'M', bust: [89, 94], waist: [69, 74], hips: [94, 99] },
            { size: 'L', bust: [94, 99], waist: [74, 79], hips: [99, 104] },
            { size: 'XL', bust: [99, 104], waist: [79, 84], hips: [104, 109] },
            { size: 'XXL', bust: [104, 109], waist: [84, 89], hips: [109, 114] }
          ],
          bottoms: [
            { size: 'XS', waist: [61, 64], hips: [86, 89] },
            { size: 'S', waist: [64, 69], hips: [89, 94] },
            { size: 'M', waist: [69, 74], hips: [94, 99] },
            { size: 'L', waist: [74, 79], hips: [99, 104] },
            { size: 'XL', waist: [79, 84], hips: [104, 109] },
            { size: 'XXL', waist: [84, 89], hips: [109, 114] }
          ],
          activewear: [
            { size: 'XS', bust: [81, 84], waist: [61, 64], hips: [86, 89] },
            { size: 'S', bust: [84, 89], waist: [64, 69], hips: [89, 94] },
            { size: 'M', bust: [89, 94], waist: [69, 74], hips: [94, 99] },
            { size: 'L', bust: [94, 99], waist: [74, 79], hips: [99, 104] },
            { size: 'XL', bust: [99, 104], waist: [79, 84], hips: [104, 109] },
            { size: 'XXL', bust: [104, 109], waist: [84, 89], hips: [109, 114] }
          ]
        }
      }
    };

    // Brand Database
    const brandDatabase = {
      US: {
        'H&M': { adjustment: 0, note: 'True to size' },
        'Zara': { adjustment: -1, note: 'Runs small' },
        'Forever 21': { adjustment: 0, note: 'True to size' },
        'Gap': { adjustment: 1, note: 'Runs large' },
        'Old Navy': { adjustment: 1, note: 'Runs large' },
        'Target (Wild Fable)': { adjustment: 0, note: 'True to size' },
        'Urban Outfitters': { adjustment: -1, note: 'Runs small' },
        'American Eagle': { adjustment: 0, note: 'True to size' }
      }
    };

    // Navigation Functions
    function showScreen(screenId) {
      document.querySelectorAll('.screen').forEach(screen => {
        screen.classList.remove('active');
      });
      document.getElementById(screenId).classList.add('active');
      
      document.querySelectorAll('.nav-item').forEach(item => {
        item.classList.remove('active');
      });
      document.querySelector(`[onclick="showScreen('${screenId}')"]`).classList.add('active');
      
      if (screenId === 'stats') {
        updateStatsDisplay();
      }
    }

    function enterHub(region) {
      appState.currentRegion = region;
      const flags = { US: 'üá∫üá∏', UK: 'üá¨üáß', EU: 'üá™üá∫', AU: 'üá¶üá∫' };
      document.querySelector('.hub-flag').textContent = flags[region];
      document.querySelector('.hub-title').textContent = `${region} Sizing`;
      showScreen('hub');
    }

    function showSizeFinder(category) {
      appState.currentCategory = category;
      document.querySelector('#sizeFinder h2').textContent = `Find Your ${category.charAt(0).toUpperCase() + category.slice(1)} Size`;
      showScreen('sizeFinder');
      
      // Pre-fill from current profile
      fillFromCurrentProfile();
    }

    function goBack() {
      showScreen('hub');
    }

    // Advanced Size Calculation
    function calculateSize() {
      const bust = parseFloat(document.getElementById('bust').value);
      const waist = parseFloat(document.getElementById('waist').value);
      const hips = parseFloat(document.getElementById('hips').value);
      
      if (!waist) {
        showNotification('Please enter at least waist measurement', 'error');
        return;
      }
      
      const measurements = { bust, waist, hips };
      const size = findBestSize(measurements);
      
      if (size) {
        document.getElementById('resultSize').textContent = size;
        document.getElementById('sizeResult').classList.add('show');
        showBrandRecommendations(size);
        
        // Save to profile and history
        saveMeasurement(measurements, size);
        showNotification('Size calculated successfully!');
      } else {
        showNotification('Unable to determine size with provided measurements', 'error');
      }
    }

    function findBestSize(measurements) {
      const chart = sizeCharts[appState.currentRegion]?.[appState.currentType]?.[appState.currentCategory];
      if (!chart) return null;
      
      let bestMatch = null;
      let bestScore = 0;
      
      chart.forEach(sizeData => {
        let score = 0;
        let matches = 0;
        
        Object.keys(measurements).forEach(key => {
          if (measurements[key] && sizeData[key]) {
            const [min, max] = sizeData[key];
            if (measurements[key] >= min && measurements[key] <= max) {
              score += 2;
            } else if (measurements[key] >= min - 2 && measurements[key] <= max + 2) {
              score += 1;
            }
            matches++;
          }
        });
        
        if (matches > 0) {
          score = score / matches;
          if (score > bestScore) {
            bestScore = score;
            bestMatch = sizeData.size;
          }
        }
      });
      
      return bestMatch;
    }

    function showBrandRecommendations(baseSize) {
      const brands = brandDatabase[appState.currentRegion] || {};
      const brandGrid = document.getElementById('brandGrid');
      
      let html = '';
      Object.keys(brands).forEach(brandName => {
        const brand = brands[brandName];
        let adjustedSize = baseSize;
        
        // Simple size adjustment logic
        if (brand.adjustment === -1) {
          const sizes = ['XS', 'S', 'M', 'L', 'XL', 'XXL'];
          const index = sizes.indexOf(baseSize);
          if (index > 0) adjustedSize = sizes[index - 1];
        } else if (brand.adjustment === 1) {
          const sizes = ['XS', 'S', 'M', 'L', 'XL', 'XXL'];
          const index = sizes.indexOf(baseSize);
          if (index < sizes.length - 1) adjustedSize = sizes[index + 1];
        }
        
        html += `
          <div class="brand-card">
            <div class="brand-name">${brandName}</div>
            <div class="brand-size">${adjustedSize}</div>
            <div style="font-size: 12px; color: var(--muted); margin-top: 4px;">${brand.note}</div>
          </div>
        `;
      });
      
      brandGrid.innerHTML = html;
      document.getElementById('brandRecommendations').style.display = 'block';
    }

    // Stats Functions
    function showStatsTab(tabName) {
      document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(content => content.style.display = 'none');
      
      document.querySelector(`[onclick="showStatsTab('${tabName}')"]`).classList.add('active');
      document.getElementById(`stats${tabName.charAt(0).toUpperCase() + tabName.slice(1)}`).style.display = 'block';
    }

    function updateStatsDisplay() {
      const currentProfile = getCurrentProfile();
      if (currentProfile) {
        const bmi = calculateBMI(currentProfile.weight, currentProfile.height);
        document.getElementById('currentBMI').textContent = bmi ? bmi.toFixed(1) : '--';
      }
      
      document.getElementById('totalMeasurements').textContent = appState.measurements.length;
      document.getElementById('activeDays').textContent = getActiveDays();
      
      updateHistoryDisplay();
    }

    function calculateBMI(weight, height) {
      if (!weight || !height) return null;
      const heightInMeters = height / 100;
      return weight / (heightInMeters * heightInMeters);
    }

    function getActiveDays() {
      const dates = appState.measurements.map(m => m.date.split('T')[0]);
      return new Set(dates).size;
    }

    function updateHistoryDisplay() {
      const historyList = document.getElementById('historyList');
      
      if (appState.measurements.length === 0) {
        historyList.innerHTML = '<p style="text-align: center; color: var(--muted); margin: 20px 0;">No measurements recorded yet</p>';
        return;
      }
      
      let html = '';
      appState.measurements.slice(-10).reverse().forEach(measurement => {
        const date = new Date(measurement.date).toLocaleDateString();
        html += `
          <div class="history-item">
            <div>
              <div style="font-weight: 700;">${measurement.category} - ${measurement.size}</div>
              <div style="font-size: 12px; color: var(--muted);">${date}</div>
            </div>
            <div style="text-align: right; font-size: 14px; color: var(--muted);">
              ${measurement.bust ? `B:${measurement.bust} ` : ''}
              ${measurement.waist ? `W:${measurement.waist} ` : ''}
              ${measurement.hips ? `H:${measurement.hips}` : ''}
            </div>
          </div>
        `;
      });
      
      historyList.innerHTML = html;
    }

    // Profile Management Functions
    function showCreateProfile() {
      showModal('Create New Profile', `
        <div class="form-group">
          <label class="form-label">Profile Name</label>
          <input type="text" class="form-input" id="modalProfileName" placeholder="Enter profile name">
        </div>
        <div class="form-group">
          <label class="form-label">Height (cm)</label>
          <input type="number" class="form-input" id="modalProfileHeight" placeholder="Enter height">
        </div>
        <div class="form-group">
          <label class="form-label">Weight (kg)</label>
          <input type="number" class="form-input" id="modalProfileWeight" placeholder="Enter weight">
        </div>
        <div class="form-group">
          <label class="form-label">Bust (cm) - Optional</label>
          <input type="number" class="form-input" id="modalProfileBust" placeholder="Enter bust measurement">
        </div>
        <div class="form-group">
          <label class="form-label">Waist (cm) - Optional</label>
          <input type="number" class="form-input" id="modalProfileWaist" placeholder="Enter waist measurement">
        </div>
        <div class="form-group">
          <label class="form-label">Hips (cm) - Optional</label>
          <input type="number" class="form-input" id="modalProfileHips" placeholder="Enter hip measurement">
        </div>
        <div class="button-group">
          <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
          <button class="btn btn-primary" onclick="saveNewProfile()">Save Profile</button>
        </div>
      `);
    }

    function saveNewProfile() {
      const name = document.getElementById('modalProfileName').value;
      const height = parseFloat(document.getElementById('modalProfileHeight').value);
      const weight = parseFloat(document.getElementById('modalProfileWeight').value);
      const bust = parseFloat(document.getElementById('modalProfileBust').value) || null;
      const waist = parseFloat(document.getElementById('modalProfileWaist').value) || null;
      const hips = parseFloat(document.getElementById('modalProfileHips').value) || null;
      
      if (!name || !height || !weight) {
        showNotification('Please fill in name, height, and weight', 'error');
        return;
      }
      
      const profile = {
        id: Date.now().toString(),
        name,
        height,
        weight,
        bust,
        waist,
        hips,
        created: new Date().toISOString()
      };
      
      appState.profiles.push(profile);
      saveToStorage();
      closeModal();
      showNotification('Profile created successfully!');
    }

    function showViewProfiles() {
      if (appState.profiles.length === 0) {
        showNotification('No profiles found. Create a profile first!', 'warning');
        return;
      }
      
      let html = '<div style="max-height: 400px; overflow-y: auto;">';
      appState.profiles.forEach(profile => {
        const isActive = profile.id === appState.currentProfile;
        const bmi = calculateBMI(profile.weight, profile.height);
        
        html += `
          <div style="background: var(--bg); border: 2px solid ${isActive ? 'var(--brand)' : 'var(--border)'}; border-radius: 12px; padding: 16px; margin-bottom: 12px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
              <strong style="color: var(--text);">${profile.name}</strong>
              ${isActive ? '<span style="background: var(--green); color: #fff; padding: 4px 8px; border-radius: 4px; font-size: 12px;">Current</span>' : ''}
            </div>
            <div style="font-size: 14px; color: var(--muted); margin-bottom: 8px;">
              Height: ${profile.height}cm | Weight: ${profile.weight}kg | BMI: ${bmi ? bmi.toFixed(1) : 'N/A'}
            </div>
            ${profile.bust || profile.waist || profile.hips ? `
              <div style="font-size: 12px; color: var(--muted); margin-bottom: 12px;">
                ${profile.bust ? `Bust: ${profile.bust}cm ` : ''}
                ${profile.waist ? `Waist: ${profile.waist}cm ` : ''}
                ${profile.hips ? `Hips: ${profile.hips}cm` : ''}
              </div>
            ` : ''}
            <div>
              <button onclick="setCurrentProfile('${profile.id}')" style="background: var(--blue); color: #fff; border: 0; padding: 8px 16px; border-radius: 6px; margin-right: 8px; cursor: pointer;">Use Profile</button>
              <button onclick="editProfile('${profile.id}')" style="background: var(--orange); color: #fff; border: 0; padding: 8px 16px; border-radius: 6px; margin-right: 8px; cursor: pointer;">Edit</button>
              <button onclick="deleteProfile('${profile.id}')" style="background: var(--red); color: #fff; border: 0; padding: 8px 16px; border-radius: 6px; cursor: pointer;">Delete</button>
            </div>
          </div>
        `;
      });
      html += '</div>';
      
      showModal('Your Profiles', html);
    }

    function setCurrentProfile(profileId) {
      appState.currentProfile = profileId;
      saveToStorage();
      closeModal();
      showNotification('Profile set as current!');
    }

    function editProfile(profileId) {
      const profile = appState.profiles.find(p => p.id === profileId);
      if (!profile) return;
      
      showModal('Edit Profile', `
        <div class="form-group">
          <label class="form-label">Profile Name</label>
          <input type="text" class="form-input" id="editProfileName" value="${profile.name}">
        </div>
        <div class="form-group">
          <label class="form-label">Height (cm)</label>
          <input type="number" class="form-input" id="editProfileHeight" value="${profile.height}">
        </div>
        <div class="form-group">
          <label class="form-label">Weight (kg)</label>
          <input type="number" class="form-input" id="editProfileWeight" value="${profile.weight}">
        </div>
        <div class="form-group">
          <label class="form-label">Bust (cm)</label>
          <input type="number" class="form-input" id="editProfileBust" value="${profile.bust || ''}">
        </div>
        <div class="form-group">
          <label class="form-label">Waist (cm)</label>
          <input type="number" class="form-input" id="editProfileWaist" value="${profile.waist || ''}">
        </div>
        <div class="form-group">
          <label class="form-label">Hips (cm)</label>
          <input type="number" class="form-input" id="editProfileHips" value="${profile.hips || ''}">
        </div>
        <div class="button-group">
          <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
          <button class="btn btn-primary" onclick="saveEditedProfile('${profileId}')">Save Changes</button>
        </div>
      `);
    }

    function saveEditedProfile(profileId) {
      const profile = appState.profiles.find(p => p.id === profileId);
      if (!profile) return;
      
      profile.name = document.getElementById('editProfileName').value;
      profile.height = parseFloat(document.getElementById('editProfileHeight').value);
      profile.weight = parseFloat(document.getElementById('editProfileWeight').value);
      profile.bust = parseFloat(document.getElementById('editProfileBust').value) || null;
      profile.waist = parseFloat(document.getElementById('editProfileWaist').value) || null;
      profile.hips = parseFloat(document.getElementById('editProfileHips').value) || null;
      
      if (!profile.name || !profile.height || !profile.weight) {
        showNotification('Please fill in name, height, and weight', 'error');
        return;
      }
      
      saveToStorage();
      closeModal();
      showNotification('Profile updated successfully!');
    }

    function deleteProfile(profileId) {
      if (confirm('Are you sure you want to delete this profile? This action cannot be undone.')) {
        appState.profiles = appState.profiles.filter(p => p.id !== profileId);
        if (appState.currentProfile === profileId) {
          appState.currentProfile = null;
        }
        saveToStorage();
        closeModal();
        showNotification('Profile deleted successfully!');
      }
    }

    // Import/Export Functions
    function showImportExport() {
      const exportData = {
        profiles: appState.profiles,
        measurements: appState.measurements,
        settings: appState.settings,
        currentProfile: appState.currentProfile,
        exportDate: new Date().toISOString(),
        version: '2.0.0'
      };
      
      showModal('Import/Export Data', `
        <div class="tabs" style="margin-bottom: 20px;">
          <div class="tab active" onclick="switchImportExportTab('export')">Export</div>
          <div class="tab" onclick="switchImportExportTab('import')">Import</div>
        </div>
        
        <div id="exportTab">
          <h4>Export Your Data</h4>
          <p style="color: var(--muted); font-size: 14px;">Copy this data to backup your profiles and measurements:</p>
          <textarea readonly onclick="this.select()" style="width: 100%; height: 200px; background: var(--bg); border: 1px solid var(--border); border-radius: 8px; padding: 12px; color: var(--text); font-family: monospace; font-size: 12px;">${JSON.stringify(exportData, null, 2)}</textarea>
          <div style="margin-top: 12px;">
            <button onclick="downloadExportData()" class="btn btn-primary" style="margin-right: 8px;">Download File</button>
            <button onclick="copyExportData()" class="btn btn-secondary">Copy to Clipboard</button>
          </div>
        </div>
        
        <div id="importTab" style="display: none;">
          <h4>Import Data</h4>
          <p style="color: var(--muted); font-size: 14px;">Paste exported data or upload a file:</p>
          <textarea id="importDataText" placeholder="Paste your exported data here..." style="width: 100%; height: 150px; background: var(--card); border: 1px solid var(--border); border-radius: 8px; padding: 12px; color: var(--text); font-family: monospace; font-size: 12px;"></textarea>
          <div style="margin: 12px 0;">
            <input type="file" id="importFile" accept=".json,.txt" style="margin-bottom: 12px;">
          </div>
          <div class="button-group">
            <button onclick="closeModal()" class="btn btn-secondary">Cancel</button>
            <button onclick="processImportData()" class="btn btn-primary">Import Data</button>
          </div>
        </div>
      `);
      
      // Add file input handler
      setTimeout(() => {
        document.getElementById('importFile').addEventListener('change', handleFileImport);
      }, 100);
    }

    function switchImportExportTab(tab) {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelector(`[onclick="switchImportExportTab('${tab}')"]`).classList.add('active');
      
      document.getElementById('exportTab').style.display = tab === 'export' ? 'block' : 'none';
      document.getElementById('importTab').style.display = tab === 'import' ? 'block' : 'none';
    }

    function downloadExportData() {
      const exportData = {
        profiles: appState.profiles,
        measurements: appState.measurements,
        settings: appState.settings,
        currentProfile: appState.currentProfile,
        exportDate: new Date().toISOString(),
        version: '2.0.0'
      };
      
      const dataStr = JSON.stringify(exportData, null, 2);
      const blob = new Blob([dataStr], {type: 'application/json'});
      const url = URL.createObjectURL(blob);
      
      const a = document.createElement('a');
      a.href = url;
      a.download = `misize-backup-${new Date().toISOString().split('T')[0]}.json`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      
      showNotification('Export file downloaded!');
    }

    function copyExportData() {
      const exportData = {
        profiles: appState.profiles,
        measurements: appState.measurements,
        settings: appState.settings,
        currentProfile: appState.currentProfile,
        exportDate: new Date().toISOString(),
        version: '2.0.0'
      };
      
      const textarea = document.createElement('textarea');
      textarea.value = JSON.stringify(exportData, null, 2);
      document.body.appendChild(textarea);
      textarea.select();
      document.execCommand('copy');
      document.body.removeChild(textarea);
      
      showNotification('Data copied to clipboard!');
    }

    function handleFileImport(event) {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          document.getElementById('importDataText').value = e.target.result;
        };
        reader.readAsText(file);
      }
    }

    function processImportData() {
      try {
        const importText = document.getElementById('importDataText').value;
        if (!importText.trim()) {
          showNotification('Please provide data to import', 'error');
          return;
        }
        
        const data = JSON.parse(importText);
        
        if (!data.profiles || !Array.isArray(data.profiles)) {
          showNotification('Invalid data format - missing profiles', 'error');
          return;
        }
        
        // Merge or replace data
        const mergeChoice = confirm('Do you want to merge with existing data?\nOK = Merge, Cancel = Replace all data');
        
        if (mergeChoice) {
          // Merge data
          data.profiles.forEach(profile => {
            if (!appState.profiles.find(p => p.id === profile.id)) {
              appState.profiles.push(profile);
            }
          });
          
          if (data.measurements && Array.isArray(data.measurements)) {
            data.measurements.forEach(measurement => {
              if (!appState.measurements.find(m => m.date === measurement.date)) {
                appState.measurements.push(measurement);
              }
            });
          }
        } else {
          // Replace all data
          appState.profiles = data.profiles;
          appState.measurements = data.measurements || [];
          appState.currentProfile = data.currentProfile || null;
        }
        
        if (data.settings) {
          appState.settings = { ...appState.settings, ...data.settings };
        }
        
        saveToStorage();
        closeModal();
        showNotification('Data imported successfully!');
        
        if (appState.currentProfile) {
          fillFromCurrentProfile();
        }
      } catch (e) {
        showNotification('Error importing data: ' + e.message, 'error');
      }
    }

    // Data Management Functions
    function clearAllData() {
      if (confirm('Are you sure you want to clear all data? This cannot be undone.')) {
        if (confirm('This will delete ALL profiles, measurements, and settings. Are you absolutely sure?')) {
          appState.profiles = [];
          appState.measurements = [];
          appState.currentProfile = null;
          appState.settings = {};
          
          saveToStorage();
          showNotification('All data cleared successfully!');
          
          // Clear form inputs
          document.getElementById('bust').value = '';
          document.getElementById('waist').value = '';
          document.getElementById('hips').value = '';
        }
      }
    }

    function exportAllData() {
      downloadExportData();
    }

    // Quick Measurement Function
    function showQuickMeasurement() {
      showModal('Quick Measurement', `
        <div class="form-group">
          <label class="form-label">Weight (kg)</label>
          <input type="number" class="form-input" id="quickWeight" placeholder="Enter current weight">
        </div>
        <div class="form-group">
          <label class="form-label">Bust (cm) - Optional</label>
          <input type="number" class="form-input" id="quickBust" placeholder="Enter bust measurement">
        </div>
        <div class="form-group">
          <label class="form-label">Waist (cm)</label>
          <input type="number" class="form-input" id="quickWaist" placeholder="Enter waist measurement">
        </div>
        <div class="form-group">
          <label class="form-label">Hips (cm) - Optional</label>
          <input type="number" class="form-input" id="quickHips" placeholder="Enter hip measurement">
        </div>
        <div class="button-group">
          <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
          <button class="btn btn-primary" onclick="saveQuickMeasurement()">Save Measurement</button>
        </div>
      `);
    }

    function saveQuickMeasurement() {
      const weight = parseFloat(document.getElementById('quickWeight').value);
      const bust = parseFloat(document.getElementById('quickBust').value) || null;
      const waist = parseFloat(document.getElementById('quickWaist').value);
      const hips = parseFloat(document.getElementById('quickHips').value) || null;
      
      if (!weight || !waist) {
        showNotification('Please enter at least weight and waist measurement', 'error');
        return;
      }
      
      const measurement = {
        id: Date.now().toString(),
        date: new Date().toISOString(),
        weight,
        bust,
        waist,
        hips,
        category: 'manual',
        region: appState.currentRegion,
        profileId: appState.currentProfile
      };
      
      appState.measurements.push(measurement);
      
      // Update current profile weight if exists
      if (appState.currentProfile) {
        const profile = appState.profiles.find(p => p.id === appState.currentProfile);
        if (profile) {
          profile.weight = weight;
          if (bust) profile.bust = bust;
          if (waist) profile.waist = waist;
          if (hips) profile.hips = hips;
        }
      }
      
      saveToStorage();
      closeModal();
      showNotification('Measurement saved successfully!');
      updateStatsDisplay();
    }

    // Helper Functions
    function getCurrentProfile() {
      return appState.profiles.find(p => p.id === appState.currentProfile);
    }

    function fillFromCurrentProfile() {
      const profile = getCurrentProfile();
      if (profile) {
        if (profile.bust) document.getElementById('bust').value = profile.bust;
        if (profile.waist) document.getElementById('waist').value = profile.waist;
        if (profile.hips) document.getElementById('hips').value = profile.hips;
      }
    }

    function saveMeasurement(measurements, size) {
      const measurement = {
        id: Date.now().toString(),
        date: new Date().toISOString(),
        ...measurements,
        size,
        category: appState.currentCategory,
        region: appState.currentRegion,
        profileId: appState.currentProfile
      };
      
      appState.measurements.push(measurement);
      saveToStorage();
    }

    function saveToStorage() {
      localStorage.setItem('misize_profiles', JSON.stringify(appState.profiles));
      localStorage.setItem('misize_measurements', JSON.stringify(appState.measurements));
      localStorage.setItem('misize_settings', JSON.stringify(appState.settings));
      localStorage.setItem('misize_current_profile', appState.currentProfile || '');
    }

    // Help Modal Functions
    function showHelpModal(topic) {
      const helpContent = {
        measuring: `
          <h4 style="color: var(--brand); margin-bottom: 12px;">üìè How to Take Accurate Measurements</h4>
          <h5>What You'll Need:</h5>
          <ul>
            <li>A flexible measuring tape</li>
            <li>A mirror (helpful but not required)</li>
            <li>Form-fitting clothing or undergarments</li>
          </ul>
          
          <h5>General Tips:</h5>
          <ul>
            <li>Measure over form-fitting clothing or undergarments</li>
            <li>Keep the measuring tape parallel to the floor</li>
            <li>Don't pull the tape too tight - it should be snug but not constricting</li>
            <li>Take measurements at the same time of day for consistency</li>
          </ul>
          
          <h5>Specific Measurements:</h5>
          <p><strong>Bust:</strong> Measure around the fullest part of your bust, typically across the nipple line.</p>
          <p><strong>Waist:</strong> Measure around the narrowest part of your waist, usually just above the belly button.</p>
          <p><strong>Hips:</strong> Measure around the fullest part of your hips, typically 7-9 inches below the waist.</p>
        `,
        sizes: `
          <h4 style="color: var(--brand); margin-bottom: 12px;">üìä Understanding Size Systems</h4>
          <h5>Regional Differences:</h5>
          <p><strong>US Sizing:</strong> Generally runs larger than European sizing</p>
          <p><strong>UK Sizing:</strong> Similar to US but can vary by brand</p>
          <p><strong>EU Sizing:</strong> Often uses numerical sizes (34, 36, 38, etc.)</p>
          <p><strong>AU Sizing:</strong> Similar to UK sizing</p>
          
          <h5>Size Types:</h5>
          <p><strong>Standard:</strong> Regular proportions</p>
          <p><strong>Petite:</strong> Shorter torso and limbs</p>
          <p><strong>Tall:</strong> Longer torso and limbs</p>
          <p><strong>Plus:</strong> Extended size range for fuller figures</p>
          
          <h5>Brand Variations:</h5>
          <p>Remember that each brand may fit differently. Our app provides brand-specific recommendations when possible.</p>
        `,
        profiles: `
          <h4 style="color: var(--brand); margin-bottom: 12px;">üë§ Profile Management</h4>
          <h5>Creating Profiles:</h5>
          <ul>
            <li>Create separate profiles for different people or time periods</li>
            <li>Include name, height, weight, and key measurements</li>
            <li>Update measurements as they change over time</li>
          </ul>
          
          <h5>Using Profiles:</h5>
          <ul>
            <li>Set one profile as "current" for automatic form filling</li>
            <li>Switch between profiles easily</li>
            <li>Track measurement history per profile</li>
          </ul>
          
          <h5>Data Safety:</h5>
          <ul>
            <li>Export your data regularly as backup</li>
            <li>Data is stored locally on your device</li>
            <li>Use import/export to transfer between devices</li>
          </ul>
        `,
        tips: `
          <h4 style="color: var(--brand); margin-bottom: 12px;">üí° Professional Fitting Tips</h4>
          <h5>Size Selection:</h5>
          <ul>
            <li>When between sizes, consider the garment type and your preferences</li>
            <li>Choose smaller for fitted styles, larger for relaxed fits</li>
            <li>Check return policies before purchasing</li>
          </ul>
          
          <h5>Brand Research:</h5>
          <ul>
            <li>Read reviews for sizing feedback</li>
            <li>Check brand-specific size guides</li>
            <li>Look for "true to size" vs "runs small/large" comments</li>
          </ul>
          
          <h5>Measurement Timing:</h5>
          <ul>
            <li>Measure at the same time of day for consistency</li>
            <li>Consider body changes throughout the month</li>
            <li>Re-measure every 3-6 months or after significant changes</li>
          </ul>
        `
      };
      
      showModal('Help Guide', helpContent[topic] || 'Help topic not found.');
    }

    // Notification System
    function showNotification(message, type = 'success') {
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      notification.textContent = message;
      
      document.body.appendChild(notification);
      
      setTimeout(() => notification.classList.add('show'), 100);
      
      setTimeout(() => {
        notification.classList.remove('show');
        setTimeout(() => {
          if (document.body.contains(notification)) {
            document.body.removeChild(notification);
          }
        }, 300);
      }, 3000);
    }

    // Modal System
    function showModal(title, content) {
      const modal = document.createElement('div');
      modal.className = 'modal';
      modal.innerHTML = `
        <div class="modal-content">
          <h3 style="color: var(--brand); margin: 0 0 20px; text-align: center;">${title}</h3>
          ${content}
        </div>
      `;
      
      modal.addEventListener('click', (e) => {
        if (e.target === modal) closeModal();
      });
      
      document.body.appendChild(modal);
      window.currentModal = modal;
    }

    function closeModal() {
      if (window.currentModal) {
        window.currentModal.remove();
        window.currentModal = null;
      }
    }

    // Settings Pills Event Handlers
    document.querySelectorAll('[data-type]').forEach(pill => {
      pill.addEventListener('click', (e) => {
        document.querySelectorAll('[data-type]').forEach(p => p.classList.remove('active'));
        e.target.classList.add('active');
        appState.currentType = e.target.dataset.type;
        saveToStorage();
      });
    });

    document.querySelectorAll('[data-unit]').forEach(pill => {
      pill.addEventListener('click', (e) => {
        document.querySelectorAll('[data-unit]').forEach(p => p.classList.remove('active'));
        e.target.classList.add('active');
        appState.currentUnit = e.target.dataset.unit;
        saveToStorage();
        // TODO: Implement unit conversion in the UI
      });
    });

    // Initialize App
    document.addEventListener('DOMContentLoaded', function() {
      // Load saved settings
      if (appState.currentProfile) {
        fillFromCurrentProfile();
      }
      
      updateStatsDisplay();
      
      // Welcome message for new users
      if (appState.profiles.length === 0 && appState.measurements.length === 0) {
        setTimeout(() => {
          showNotification('Welcome to MiSize! Create a profile in Settings to get started.', 'info');
        }, 1000);
      }
    });
  </script>
</body>
</html>
